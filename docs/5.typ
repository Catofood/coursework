#import "lib/gost.typ": *
#import "lib/titlepage.typ": *

#show: doc => init(doc)

= Анализ предметной области
-
= Разработка и анализ требований к программе
-
= Проектирование структуры программы
-
= Разработка и отладка  программы
-
= Тестирование

== Цели и организация тестирования

Тестирование микросервиса выполнялось с целью проверки корректности реализации всех функциональных требований, определенных в разделе "Разработка требований к программе". Тестовая стратегия включает разработку комплексного набора юнит тестов, которые проверяют изолированную функциональность отдельных компонентов без зависимостей от внешних систем.

Все тестовые сценарии реализованы в виде автоматизированных модульных (юнит) тестов с использованием фреймворка Xunit для .NET. Юнит тесты представляют собой быстрые и независимые проверки отдельных методов и классов, позволяющие разработчикам оперативно выявлять регрессии и ошибки в коде.

*Организация и структура тестирования*: тесты организованы по архитектурным слоям приложения, что позволяет эффективно управлять и поддерживать тестовый код. Для изоляции компонентов используется in-memory база данных Entity Framework Core, что исключает необходимость подключения к реальной PostgreSQL при выполнении тестов и значительно ускоряет их выполнение. Параметризованные тесты (Theory и InlineData) обеспечивают проверку одной функции с множеством различных входных значений, что позволяет повысить эффективность тестового покрытия без дублирования кода.

*Целевые компоненты юнит тестирования*: Query Handlers — проверка логики получения аналитических данных с различными фильтрами; Command Handlers — проверка обработки команд изменения состояния системы; Validators — проверка корректности валидации входных параметров (диапазоны дат, числовые значения); Middleware — проверка преобразования исключений в соответствующие HTTP статус-коды и форматы ответов.

*Методология проведения тестов*: каждый юнит тест следует трехэтапной структуре Arrange-Act-Assert, где на этапе Arrange подготавливается изолированное окружение и тестовые данные, на этапе Act выполняется проверяемая функциональность, и на этапе Assert верифицируются ожидаемые результаты. Все тесты выполняются независимо друг от друга, что гарантирует воспроизводимость результатов и исключает побочные эффекты между тестовыми сценариями.

== Описание тестовых сценариев

Разработана комплексная система тестирования, покрывающая все уровни приложения. В таблице @table-test-technologies представлены основные тестовые классы, организованные по слоям приложения с указанием их назначения и проверяемых функций.

#figure(
  long-table(
    columns: (1.8fr, 1.8fr, 3fr),
    align: (horizon, horizon, left),
    inset: 6pt,
    [*Тестовый класс*], [*Описание*],[*Проверяемая функциональность*],
    table.cell(colspan: 3, align: center)[*Application Layer — Query Handlers (обработчики запросов статистики)*],
    table.cell(rowspan: 4)[GetRegisteredUsers
    CountQueryHandler
    Tests], table.cell(rowspan: 4)[Тестирование подсчета пользователей], [Проверка получения общего количества зарегистрированных пользователей без применения фильтров],
    [Проверка фильтрации по дате начала периода],
    [Проверка фильтрации по дате окончания периода],
    [Проверка фильтрации по диапазону дат с указанием начала и окончания периода],
    table.cell(rowspan: 4)[GetUniqueSchedule
    ViewersCountQuery
    HandlerTests], table.cell(rowspan: 4)[Тестирование уникальных просмотров расписания], [Проверка подсчета уникальных пользователей по всем типам просмотров расписания (аудиторий, групп, преподавателей)],
    [Проверка исключения дубликатов запросов от одного пользователя],
    [Проверка исключения поисковых запросов из статистики],
    [Проверка фильтрации результатов по временным периодам],
    table.cell(rowspan: 3)[GetGroupSchedule
    RequestsCountQuery
    HandlerTests], table.cell(rowspan: 3)[Подсчет просмотров расписания групп], [Проверка подсчета всех запросов на просмотр расписания групп за указанный период],
    [Проверка исключения из подсчета запросов других типов],
    [Проверка корректности применения фильтрации по дате начала и окончания периода],
    table.cell(rowspan: 4)[GetTopGroupsBy
    RequestsQuery
    HandlerTests], table.cell(rowspan: 4)[Получение топ-групп по количеству просмотров], [Проверка корректности сортировки групп по количеству запросов в порядке убывания],
    [Проверка ограничения количества результатов параметром top],
    [Проверка подсчета всех запросов включая повторные от одного пользователя],
    [Проверка корректности работы при наличии нескольких групп],
    table.cell(rowspan: 4)[GetTopGroupsBy
    SubscribersQuery
    HandlerTests], table.cell(rowspan: 4)[Получение топ-групп по количеству подписчиков], [Проверка корректности сортировки групп по количеству уникальных подписчиков в порядке убывания],
    [Проверка ограничения количества результатов параметром top],
    [Проверка исключения повторных подписок одного пользователя],
    [Проверка фильтрации результатов по датам подписок],
    table.cell(rowspan: 4)[ScheduleViewersBy
    TypeQueryHandler
    Tests], table.cell(rowspan: 4)[Статистика просмотров по типам запросов], [Проверка работы запроса получения уникальных пользователей, просмотревших расписание аудиторий],
    [Проверка работы запроса получения уникальных пользователей, просмотревших расписание групп],
    [Проверка работы запроса получения уникальных пользователей, просмотревших расписание преподавателей],
    [Проверка применения фильтрации по временным периодам для всех типов запросов],
    table.cell(rowspan: 6)[UserSettingsQuery
    HandlerTests], table.cell(rowspan: 6)[Статистика по настройкам пользователей], [Проверка работы запроса получения количества пользователей с кастомными настройками],
    [Проверка работы запроса получения количества пользователей с дефолтными настройками],
    [Проверка работы запроса получения количества пользователей, устанавливавших кастомные настройки],
    [Проверка учета только последнего обновления настроек пользователя],
    [Проверка игнорирования событий других типов],
    [Проверка фильтрации результатов по временным периодам],
    table.cell(rowspan: 5)[SearchQueryHandler
    Tests], table.cell(rowspan: 5)[Тестирование функциональности поиска], [Проверка работы запроса получения уникальных пользователей, выполнивших поиск],
    [Проверка подсчета уникальных пользователей без учета повторных поисковых запросов],
    [Проверка исключения дубликатов при подсчете пользователей],
    [Проверка фильтрации результатов по диапазону дат],
    [Проверка исключения из подсчета запросов других типов],
    table.cell(rowspan: 3)[QueryValidationTests], table.cell(rowspan: 3)[Комплексная валидация входных параметров], [Проверка выброса исключения InvalidDateRangeException при указании даты начала позже даты окончания],
    [Проверка выброса исключения InvalidParameterException при указании дат в будущем],
    [Проверка выброса исключения InvalidParameterException при указании значения параметра top вне допустимого диапазона от 1 до 100],
    table.cell(colspan: 3, align: center)[*Application Layer — Validators (валидаторы входных данных)*],
    table.cell(rowspan: 5)[DateRangeValidator
    Tests], table.cell(rowspan: 5)[Валидация диапазонов дат], [Проверка метода ValidateDateRange на корректность валидации условия, что дата начала не может быть позже даты окончания],
    [Проверка метода ValidateNotFuture на корректность валидации условия, что указанная дата не может быть в будущем],
    [Проверка позитивных сценариев с корректным диапазоном дат, равными датами и значениями null],
    [Проверка негативных сценариев с некорректным диапазоном и датами в будущем],
    [Проверка корректности формата сообщений об ошибках с указанием дат в формате ISO],
    table.cell(rowspan: 5)[NumericParameter
    ValidatorTests], table.cell(rowspan: 5)[Валидация числовых параметров], [Проверка метода ValidatePositiveInteger для параметров top, limit, count на соответствие допустимым диапазонам значений],
    [Проверка диапазонов со значениями по умолчанию от 1 до 1000 и специальным диапазоном для параметра top от 1 до 100],
    [Проверка корректности обработки граничных значений (минимум и максимум диапазона)],
    [Проверка возможности задания кастомных диапазонов для различных параметров],
    [Проверка корректности формирования сообщений об ошибках с указанием допустимых границ значений],
    table.cell(colspan: 3, align: center)[*WebApi Layer — Middleware (обработка исключений)*],
    table.cell(rowspan: 9)[ExceptionHandling
    MiddlewareTests], table.cell(rowspan: 9)[Преобразование исключений в HTTP статус-коды], [Проверка преобразования исключений ArgumentNullException, ArgumentException, ArgumentOutOfRangeException, FormatException в HTTP статус-код 400],
    [Проверка преобразования InvalidOperationException в HTTP статус-код 409 (или 404 для исключения с текстом "Sequence contains no elements")],
    [Проверка преобразования KeyNotFoundException в HTTP статус-код 404],
    [Проверка преобразования UnauthorizedAccessException в HTTP статус-код 403],
    [Проверка преобразования OperationCanceledException в HTTP статус-код 499],
    [Проверка преобразования кастомных исключений InvalidDateRangeException, InvalidParameterException, ValidationException в HTTP статус-код 400],
    [Проверка преобразования необработанных исключений в HTTP статус-код 500],
    [Проверка корректности формата ответа application/json с наличием полей status и detail],
    [Проверка отсутствия стек-трейсов в production окружении],
  ),
  caption: "Структура и назначение основных тестовых классов",
  kind: table
)<table-test-scenarios>

== Результаты тестирования

В таблице @tbl-test-results представлены результаты выполнения основных тестовых сценариев. Каждый сценарий проверяет определённый функциональный аспект системы, включая получение статистики, фильтрацию данных, валидацию параметров и обработку ошибок в различных компонентах микросервиса.

#figure(
  long-table(
    columns: (auto, 1fr, 1.5fr, 1.2fr, 0.8fr),
    align: horizon,
    [*№*], [*Название теста*], [*Тестовые данные*], [*Ожидаемый результат*], [*Статус*],
    [1], [Получение общего количества пользователей], [3 пользователя (01.2024, 02.2024, 03.2024), фильтры: from=null, to=null], [Количество: 3], [Успешно выполнен],
    
    [2], [Фильтрация пользователей по дате начала], [3 пользователя, фильтр: from=15.02.2024, to=null], [Количество: 2 (пользователи с 15.02.2024 и позже)], [Успешно выполнен],
    
    [3], [Фильтрация пользователей по дате окончания], [3 пользователя, фильтр: from=null, to=10.02.2024], [Количество: 2 (пользователи до 10.02.2024 включительно)], [Успешно выполнен],
    
    [4], [Подсчет уникальных пользователей], [2 пользователя, 4 запроса (1 пользователь выполнил 3 запроса)], [Количество уникальных: 2], [Успешно выполнен],
    
    [5], [Исключение поисковых запросов из статистики], [2 пользователя: 1 просмотр расписания, 1 поиск], [Количество уникальных: 1 (только просмотры расписания)], [Успешно выполнен],
    
    [6], [Топ групп по количеству просмотров], [3 группы: group-a (4 запроса), group-b (2), group-c (1)], [Список отсортирован: group-a, group-b, group-c с соответствующими счетчиками], [Успешно выполнен],
    
    [7], [Ограничение количества результатов], [5 групп с запросами, параметр top=2], [Возвращается ровно 2 группы], [Успешно выполнен],
    [8], [Валидация: корректный диапазон дат], [from=01.01.2024, to=31.12.2024], [Исключение не выбрасывается], [Успешно выполнен],
    
    [9], [Валидация: равные даты], [from=15.06.2024, to=15.06.2024], [Исключение не выбрасывается (допустимо)], [Успешно выполнен],
    
    [10], [Валидация: обе даты null], [from=null, to=null], [Исключение не выбрасывается (фильтрация отсутствует)], [Успешно выполнен],
    
    [11], [Ошибка: некорректный диапазон дат], [from=31.12.2024, to=01.01.2024], [InvalidDateRange Exception с сообщением "не может быть позже"], [Успешно выполнен],
    
    [12], [Ошибка: дата в будущем], [from=дата через 10 дней от текущей], [InvalidParameter Exception с сообщением "содержит будущую дату"], [Успешно выполнен],
    
    [13], [Валидация числовых параметров: допустимое значение], [top=50, min=1, max=100], [Исключение не выбрасывается], [Успешно выполнен],
    
    [14], [Ошибка: параметр меньше минимума], [top=0, min=1, max=100], [InvalidParameter Exception: "имеет некорректное значение", "Минимально: 1"], [Успешно выполнен],
    
    [15], [Ошибка: параметр больше максимума], [top=101, min=1, max=100], [InvalidParameter Exception: "имеет некорректное значение", "Максимально: 100"], [Успешно выполнен],
    
    [16], [Обработка Argument NullException], [Middleware получает ArgumentNullException], [HTTP 400 + "Некорректные параметры запроса"], [Успешно выполнен],
    
    [17], [Обработка KeyNotFound Exception], [Middleware получает KeyNotFoundException], [HTTP 404 + "Запрашиваемый ресурс не найден"], [Успешно выполнен],
    
    [18], [Обработка Invalid Operation Exception], [Middleware получает InvalidOperationException], [HTTP 409 + "Операция не может быть выполнена"], [Успешно выполнен],
    
    [19], [Обработка неизвестного исключения], [Middleware получает Exception("boom")], [HTTP 500 + "Внутренняя ошибка сервиса"], [Успешно выполнен],
    
    [20], [Обработка InvalidDate Range Exception], [Middleware получает InvalidDateRangeException с описанием диапазона], [HTTP 400, сообщение содержит детали о некорректном диапазоне], [Успешно выполнен],
    
    [21], [Подсчет запросов на просмотр расписания групп], [3 запроса GroupSchedule, 1 RoomSchedule, 1 TeacherSchedule, 1 Search], [Количество: 3 (только GroupSchedule)], [Успешно выполнен],
    
    [22], [Топ групп по подписчикам с уникальностью], [group-a: 3 уникальных подписчика, group-b: 2, group-c: 1], [Список отсортирован: group-a (3), group-b (2), group-c (1)], [Успешно выполнен],
    
    [23], [Повторная подписка одного пользователя], [1 пользователь подписался 3 раза на одну группу], [Количество уникальных подписчиков: 1], [Успешно выполнен],
    
    [24], [Подсчет просмотров по типу: RoomSchedule], [2 пользователя просмотрели RoomSchedule, 1 — GroupSchedule], [Количество уникальных: 2 (только RoomSchedule)], [Успешно выполнен],
    
    [25], [Подсчет просмотров по типу: GroupSchedule], [2 пользователя просмотрели GroupSchedule, 1 — RoomSchedule], [Количество уникальных: 2 (только GroupSchedule)], [Успешно выполнен],
    
    [26], [Подсчет просмотров по типу: Teacher Schedule], [2 пользователя просмотрели TeacherSchedule, 1 — RoomSchedule], [Количество уникальных: 2 (только TeacherSchedule)], [Успешно выполнен],
    
    [27], [Статистика настроек: последнее обновление], [user1: default→custom (last), user2: custom→default (last)], [Custom: 1 (user1), Default: 1 (user2)], [Успешно выполнен],
    
    [28], [Игнорирование событий не-настроек], [1 SetCustomSettings, 1 Registered, 1 SubscribedToGroup для одного пользователя], [Количество с custom настройками: 1], [Успешно выполнен],
    
    [29], [Подсчет пользователей, выполнявших поиск], [3 пользователя, каждый выполнил запрос Search], [Количество уникальных: 3], [Успешно выполнен],
    
    [30], [Исключение дубликатов в поиске], [1 пользователь выполнил 3 поисковых запроса], [Количество уникальных: 1], [Успешно выполнен],
    
    [31], [Фильтрация поиска по датам], [3 пользователя искали в разные даты (01.2024, 02.2024, 03.2024), диапазон: 02-03.2024], [Количество: 2 (исключен январь)], [Успешно выполнен],
    
    [32], [Валидация GetTopGroups ByRequests Query: top=0], [Параметр top=0, min=1], [InvalidParameter Exception с указанием минимума], [Успешно выполнен],
    
    [33], [Валидация GetTopGroups ByRequests Query: top=-5], [Параметр top=-5, min=1], [InvalidParameter Exception с указанием минимума], [Успешно выполнен],
    
    [34], [Валидация GetTopGroups BySubscribers Query: top вне диапазона], [Параметр top=101, max=100], [InvalidParameter Exception с указанием максимума], [Успешно выполнен],
    
    [35], [Валидация дат в GetUnique Schedule Viewers CountQuery], [from=31.12.2024, to=01.01.2024], [InvalidDate RangeException], [Успешно выполнен],
    
    [36], [Валидация дат в GetGroup Schedule Requests CountQuery], [from=30.06.2024, to=01.01.2024], [InvalidDate RangeException], [Успешно выполнен],
    
    [37], [Обработка Format Exception], [Middleware получает FormatException], [HTTP 400 + "Некорректный формат данных"], [Успешно выполнен],
    
    [38], [Обработка Unauthorized Access Exception], [Middleware получает Unauthorized Access Exception], [HTTP 403 + "Доступ запрещен"], [Успешно выполнен],
    
    [39], [Обработка Operation Canceled Exception], [Middleware получает OperationCanceled Exception], [HTTP 499 + "Запрос был отменен"], [Успешно выполнен],
    
    [40], [Обработка Invalid  Operation Exception с "no elements"], [Middleware получает InvalidOperation Exception("Sequence contains no elements")], [HTTP 404 + "Запрашиваемые данные не найдены"], [Успешно выполнен],
    
    [41], [Middleware пропускает запросы без ошибок], [Запрос обработан успешно без исключений], [HTTP 204 No Content, пустое тело ответа], [Успешно выполнен],
    
    [42], [Формат JSON ответа middleware], [Любое исключение], [Content-Type: application/json, поля: status, detail], [Успешно выполнен],
    
    [43], [Фильтрация по диапазону дат для GetRegistered UsersCount Query], [3 пользователя (01.2024, 02.2024, 03.2024), диапазон: 01.02-28.02.2024], [Количество: 1 (только февраль)], [Успешно выполнен],
    
    [44], [Валидация DateRange: from=null, корректное поведение], [from=null, to=31.12.2024], [Исключение не выбрасывается, фильтрация только по to], [Успешно выполнен],
    
    [45], [Валидация DateRange: to=null, корректное поведение], [from=01.01.2024, to=null], [Исключение не выбрасывается, фильтрация только по from], [Успешно выполнен],
    
    [46], [Топ групп по запросам: несколько пользователей на одну группу], [group-a: 1 пользователь выполнил 3 запроса, 1 пользователь - 2 запроса], [Total requests: 5 для group-a], [Успешно выполнен],
    
    [47], [Топ групп по подписчикам: ограничение по датам], [3 группы с подписчиками в разные даты, фильтр by date], [Возвращаются только группы в указанном диапазоне], [Успешно выполнен],
    
    [48], [GetUnique Schedule Viewers CountQuery: фильтрация по диапазону], [4 пользователя просмотрели расписание в разные даты, from=date2, to=date3], [Количество: 2 (в диапазоне)], [Успешно выполнен],
    
    [49], [GetGroup Schedule Requests CountQuery: фильтрация по to], [3 запроса в разные даты (01.2024, 02.2024, 03.2024), to=10.02.2024], [Количество: 2 (до 10.02 включительно)], [Успешно выполнен],
    
    [50], [GetGroup Schedule Requests CountQuery: фильтрация по диапазону], [3 запроса, from=01.02.2024, to=28.02.2024], [Количество: 1 (только в феврале)], [Успешно выполнен],
    
    [51], [Топ групп по запросам: фильтрация по диапазону дат], [3 группы с запросами в разные даты, диапазон: 01-31.02.2024], [Возвращаются только запросы в указанном диапазоне], [Успешно выполнен],
    
    [52], [Топ групп по запросам: пустой результат при отсутствии данных], [База данных пуста], [Возвращается пустой список], [Успешно выполнен],
    
    [53], [Топ групп по подписчикам: пустой результат], [База данных пуста или нет подписок], [Возвращается пустой список], [Успешно выполнен],
    
    [54], [GetUnique Schedule Viewers CountQuery: пустой результат], [База данных пуста], [Возвращается 0], [Успешно выполнен],
    
    [55], [GetRegistered Users CountQuery: пустой результат], [База данных пуста], [Возвращается 0], [Успешно выполнен],
    
    [56], [Валидация чисел: граничные значения min], [top=1 (минимум), min=1, max=100], [Исключение не выбрасывается], [Успешно выполнен],
    
    [57], [Валидация чисел: граничные значения max], [top=100 (максимум), min=1, max=100], [Исключение не выбрасывается], [Успешно выполнен],
    
    [58], [Валидация чисел: кастомный диапазон 5-10], [value=7, min=5, max=10], [Исключение не выбрасывается], [Успешно выполнен],
    
    [59], [Валидация чисел: кастомный диапазон, ниже минимума], [value=4, min=5, max=10], [InvalidParameter Exception], [Успешно выполнен],
    
    [60], [Валидация чисел: кастомный диапазон, выше максимума], [value=11, min=5, max=10], [InvalidParameter Exception], [Успешно выполнен],
    
    [61], [Валидация чисел: проверка дефолтного диапазона], [value=500, no min/max specified (default 1-1000)], [Исключение не выбрасывается], [Успешно выполнен],
    
    [62], [Валидация чисел: превышение дефолтного максимума], [value=1001, default max=1000], [InvalidParameter  Exception с упоминанием 1000], [Успешно выполнен],
    
    [63], [Валидация чисел: сообщение содержит имя параметра], [Любой некорректный параметр "mySpecialParameter"], [InvalidParameter Exception. ParameterName == "mySpecial Parameter"], [Успешно выполнен],
    
    [64], [DateRange валидация: дата в прошлом валидна], [Дата 30 дней назад], [Исключение не выбрасывается], [Успешно выполнен],
    
    [65], [DateRange валидация: null дата валидна], [date=null], [Исключение не выбрасывается], [Успешно выполнен],
    
    [66], [DateRange валидация: сообщение содержит ISO даты], [from=2024-12-31, to=2024-01-01], [Сообщение содержит "2024-12-31" и "2024-01-01"], [Успешно выполнен],
    
    [67], [UserSettings: нулевой результат при отсутствии настроек], [База данных не содержит событий настроек], [Custom: 0, Default: 0], [Успешно выполнен],
    
    [68], [User Settings: множественные изменения одного пользователя], [user1: default→custom→ default→custom], [Учитывается только последнее: custom], [Успешно выполнен],
    
    [69], [UsersWho SetCustom Settings: исключение SetDefault Settings], [2 пользователя: 1 SetCustomSettings, 1 SetDefaultSettings], [Количество: 1 (только custom)], [Успешно выполнен],
    
    [70], [UsersWho SetCustom Settings: без дубликатов], [1 пользователь установил custom 3 раза], [Количество: 1 (distinct)], [Успешно выполнен],
    
    [71], [Search: исключение других типов запросов], [3 пользователя: 2 Search, 1 GroupSchedule], [Количество: 2 (только Search)], [Успешно выполнен],
    
    [72], [Schedule Viewers: RoomSchedule без дубликатов], [1 пользователь выполнил 3 RoomSchedule запроса], [Количество: 1 (distinct)], [Успешно выполнен],
    
    [73], [Schedule Viewers: GroupSchedule без дубликатов], [1 пользователь выполнил 3 GroupSchedule запроса], [Количество: 1 (distinct)], [Успешно выполнен],
    
    [74], [Schedule Viewers: Teacher Schedule без дубликатов], [1 пользователь выполнил 3 TeacherSchedule запроса], [Количество: 1 (distinct)], [Успешно выполнен],
    
    [75], [Schedule Viewers: фильтрация по датам для всех типов], [3 пользователя просмотрели RoomSchedule в разные даты, диапазон: date2-date3], [Количество: 2 (в диапазоне)], [Успешно выполнен],
    
    [76], [Validation Exception: обработка как 400], [Middleware получает ValidationException ("Общая ошибка валидации")], [HTTP 400 + "Общая ошибка валидации"], [Успешно выполнен],
    
    [77], [Middleware: формат ответа только status и detail], [Любое исключение (например, InvalidParameter Exception)], [Response содержит только поля status и detail, нет стек-трейса], [Успешно выполнен],
  ),
  caption: "Результаты тестирования основных сценариев",
  kind: table
)<tbl-test-results>>



== Статистика покрытия тестами

Всего разработано 12 тестовых классов с более чем 100 индивидуальными тестовыми случаями. Все тесты успешно пройдены, что подтверждает корректность реализации функциональных требований микросервиса.

На рисунке @fig-test-results показано успешное выполнение юнит тестов; представлены итоговые результаты тестового прогона.

#figure(
  image("images/test-results.png"),
  caption: [Результаты выполнения юнит тестов],
  kind: image
) <fig-test-results>

В таблице @table-test-coverage представлена детализация покрытия тестами по классам и слоям приложения, включая количество тестовых методов и описание проверяемой функциональности для каждого компонента системы.

#figure(
  long-table(
    columns: (2fr, 1fr, 2fr),
    align: (left, center, left),
    inset: 6pt,
    [*Тестовый класс*], [*Кол-во тестов*], [*Описание*],
    table.cell(colspan: 3, align: center)[*Application Layer (Queries)*],
 [GetRegisteredUsersCount
 QueryHandlerTests], [5], [Подсчет зарегистрированных пользователей с фильтрацией],
    
     [GetUniqueScheduleViewersCount
     QueryHandlerTests], [6], [Подсчет уникальных пользователей, просматривавших расписание],
    
     [GetGroupScheduleRequests
     CountQueryHandlerTests], [6], [Количество просмотров расписания групп],
    
     [GetTopGroupsByRequestsQuery
     HandlerTests], [8], [Топ групп по количеству запросов],
    
     [GetTopGroupsBySubscribersQuery
     HandlerTests], [8], [Топ групп по количеству подписчиков],
    
     [ScheduleViewersByTypeQuery
     HandlerTests], [6], [Статистика просмотров по типам (Room, Group, Teacher)],
    
     [SearchQueryHandlerTests], [6], [Статистика поисковых запросов],
    
     [UserSettingsQueryHandlerTests], [7], [Статистика по настройкам пользователей],
    
     [QueryValidationTests], [12+], [Валидация параметров всех query handlers],
    table.cell(colspan: 3, align: center)[*Application Layer (Validators)*], 
    [DateRangeValidatorTests], [9], [Валидация диапазонов дат],
    
     [NumericParameterValidatorTests], [20+], [Валидация числовых параметров (8 параметризованных тестов)],
    
    table.cell(colspan: 3, align: center)[*WebApi Layer*], [ExceptionHandlingMiddlewareTests], [8+], [Обработка исключений и HTTP статус-коды],
  ),
  caption: "Покрытие тестами по слоям и компонентам приложения",
  kind: table
)<table-test-coverage>

В таблице @table-test-technologies представлены типы и цели проверяемых тестовых сценариев, применяемые при верификации функциональности микросервиса, включая позитивные, негативные и граничные случаи, а также сценарии функциональной проверки и валидации входных данных.

#figure(
  long-table(
    columns: (1fr, 2fr),
    align: (left, left),
    inset: 6pt,
    [*Тип сценария*], [*Описание и проверяемая функциональность*],
    [Позитивные], [Проверка корректной работы системы при валидных входных данных и нормальных условиях функционирования],
    [Негативные], [Проверка обработки ошибок и корректного поведения при некорректных или неожиданных данных],
    [Граничные], [Проверка поведения при null параметрах, равных датах, экстремальных значениях и пустых наборах данных],
    [Фильтрация и сортировка], [Проверка корректности выборки и упорядочения результатов по различным критериям],
    [Валидация входных параметров], [Проверка выявления и обработки некорректных значений всех API endpoints],
    [Отображение исключений], [Проверка корректного преобразования исключений в HTTP статус-коды для коммуникации ошибок],
  ),
  caption: "Типы и описание проверяемых тестовых сценариев",
  kind: table
)<table-test-scenarios>

В таблице @table-test-technologies представлены основные технологии и инструменты, используемые при разработке и выполнении тестового покрытия микросервиса, включая фреймворки, библиотеки и методики параметризованного тестирования и верификации результатов.

#figure(
  long-table(
    columns: (1fr, 2fr),
    align: (left, left),
    inset: 6pt,
    [*Технология*], [*Назначение и область применения*],
    [Xunit], [Фреймворк для модульного тестирования в .NET с удобным синтаксисом и расширяемостью],
    [InMemoryDatabase], [Обеспечение изоляции тестов базы данных без подключения к реальной БД через Entity Framework Core],
    [Theory и InlineData], [Параметризованное тестирование с множеством входных значений в одном тесте],
    [Assert методы], [Проверка ожидаемых результатов через Equal, Throws, Contains и другие проверки],
    [Record.Exception], [Перехват и проверка исключений для верификации обработки ошибок],
  ),
  caption: "Используемые технологии и инструменты тестирования",
  kind: table
)<table-test-technologies>

== Выводы по тестированию

Все разработанные функциональные возможности микросервиса прошли успешное тестирование. Проверены как успешные сценарии работы (получение статистики с различными фильтрами), так и режимы обработки ошибок (некорректные параметры, отсутствующие данные, исключительные ситуации).

Использование in-memory базы данных и параметризованных тестов обеспечивает высокую скорость выполнения тестов и их независимость друг от друга. Каждый тест создает изолированное окружение, что гарантирует воспроизводимость результатов.

Тестовое покрытие включает все критические компоненты системы: обработчики запросов, валидаторы входных данных и middleware обработки ошибок. Все тесты выполняются успешно, что подтверждает корректность реализации требований.